"use strict";const t=require("electron"),b=require("child_process"),S=require("path"),x=require("fs");function m(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const s in e)if(s!=="default"){const n=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,n.get?n:{enumerable:!0,get:()=>e[s]})}}return r.default=e,Object.freeze(r)}const c=m(S),a=m(x);function _(){const e=new t.BrowserWindow({width:1200,height:800,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:c.join(__dirname,"preload.js")}});process.env.VITE_DEV_SERVER_URL?(e.loadURL(process.env.VITE_DEV_SERVER_URL),e.webContents.openDevTools()):e.loadFile(c.join(__dirname,"../build/index.html"))}t.app.disableHardwareAcceleration();t.app.whenReady().then(_);t.app.on("window-all-closed",()=>{process.platform!=="darwin"&&t.app.quit()});t.app.on("activate",()=>{t.BrowserWindow.getAllWindows().length===0&&_()});t.ipcMain.handle("analyze-code",async(e,r)=>new Promise((s,n)=>{const f=process.platform==="win32"?".exe":"",g=c.join(__dirname,`../../core/target/release/rustots${f}`),w=c.join(__dirname,`../../core/target/debug/rustots${f}`);console.log("__dirname:",__dirname),console.log("Checking release binary:",g),console.log("Checking debug binary:",w);let i="";if(t.app.isPackaged?(i=c.join(process.resourcesPath,`rustots${f}`),console.log("Checking packaged binary:",i)):a.existsSync(g)?(i=g,console.log("Found release binary")):a.existsSync(w)&&(i=w,console.log("Found debug binary")),!i||!a.existsSync(i)){console.error("Binary not found"),n(new Error(`Rust binary not found at: ${i}`));return}const p=c.join(t.app.getPath("userData"),"temp_analysis.ts");try{a.writeFileSync(p,r)}catch(o){n(new Error(`Failed to create temp file: ${o.message}`));return}const d=b.spawn(i,[p],{stdio:["ignore","pipe","pipe"]});let y="",h="";d.stdout.on("data",o=>{y+=o.toString()}),d.stderr.on("data",o=>{h+=o.toString()}),d.on("close",o=>{try{a.existsSync(p)&&a.unlinkSync(p)}catch(l){console.error("Failed to delete temp file:",l)}if(o===0)try{const l=JSON.parse(y);s(l)}catch(l){console.error("Parse error:",l),n(new Error(`Failed to parse output: ${l.message}`))}else console.error("Process failed with code",o,"Error:",h),n(new Error(`Process exited with code ${o}: ${h}`))}),d.on("error",o=>{console.error("Spawn error:",o),n(new Error(`Failed to spawn process: ${o.message}`))})}));t.ipcMain.handle("open-file",async()=>{const e=await t.dialog.showOpenDialog({properties:["openFile"],filters:[{name:"TypeScript",extensions:["ts","tsx"]},{name:"JavaScript",extensions:["js","jsx"]},{name:"All Files",extensions:["*"]}]});if(!e.canceled&&e.filePaths.length>0){const r=e.filePaths[0],s=a.readFileSync(r,"utf-8");return{filePath:r,content:s}}return null});t.ipcMain.handle("save-file",async(e,r,s)=>{let n=s;if(!n){const u=await t.dialog.showSaveDialog({filters:[{name:"TypeScript",extensions:["ts"]},{name:"JavaScript",extensions:["js"]},{name:"All Files",extensions:["*"]}]});if(u.canceled)return null;n=u.filePath}return n?(a.writeFileSync(n,r,"utf-8"),n):null});
